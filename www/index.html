<!DOCTYPE html>
<html>
<head>
  <meta charset="utf8">
  <meta name="viewport" content="width=device-width">
  <title>Zoe Water</title>

  <link rel="stylesheet" href="/stylesheets/app.css" />
  <link rel="stylesheet" href="/components/animate.css/animate.min.css" />

  <script src="/javascripts/onerror.js"></script>
  <script src="/javascripts/console.log.js"></script>

  <!-- cordova.js is served from localhost to ensure the correct version -->
  <script src="http://localhost/cordova.js"></script>
  <script src="http://localhost/javascripts/zoe.js"></script>
  <script src="/components/steroids-js/steroids.js"></script>
  <script>
    //Pollute the global namespace with the setupEvent (thanks to Phonegap architecture)
    window.setupEvent = new Event('setup');

    var onSetup = function(){
      require(['AuthController', 'HomeController'], function(Auth, Home){

        var onMessage = function(event){
          var msg = event.data.message;

          if(msg === 'login' || msg === 'logout'){
            window.location.reload();
          }
        };

        //Listen for auth/deauth messages, this is needed
        //because of the way Steroids is architected
        window.addEventListener('message', onMessage);

        if(Parse.User.current()){
          //Initialize main view
          (new Home.Index()).show();
        }else{
          (new Auth.Index()).show();
        }
      });
    }

    // Listen for the event.
    window.addEventListener('setup', onSetup, false);
  </script>
</head>
<body>
  <script src="/components/requirejs/require.js" data-main="http://localhost/javascripts/application"></script>
  <!--script src="http://192.168.1.130:31173/target/target-script-min.js#anonymous"></script-->
</body>
</html>
